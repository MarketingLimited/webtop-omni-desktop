[supervisord]
nodaemon=true
user=root
loglevel=info
minfds=1024
minprocs=200
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid

[program:dbus]
command=/usr/local/bin/start-dbus-first.sh
priority=15
autostart=true
autorestart=true
user=root
startsecs=5
startretries=10
stdout_logfile=/var/log/supervisor/dbus.log
stderr_logfile=/var/log/supervisor/dbus.log

[program:pulseaudio]
command=/bin/sh -c "sleep 10; export XDG_RUNTIME_DIR=/run/user/%(ENV_DEV_UID)s; export HOME=/home/%(ENV_DEV_USERNAME)s; export PULSE_RUNTIME_PATH=/run/user/%(ENV_DEV_UID)s/pulse; mkdir -p /run/user/%(ENV_DEV_UID)s/pulse; chown %(ENV_DEV_USERNAME)s:%(ENV_DEV_USERNAME)s /run/user/%(ENV_DEV_UID)s/pulse; exec /usr/bin/pulseaudio --daemonize=no --disallow-exit --exit-idle-time=-1 --system=false --file=/home/%(ENV_DEV_USERNAME)s/.config/pulse/default.pa"
priority=25
autostart=true
autorestart=true
user=%(ENV_DEV_USERNAME)s
environment=HOME=/home/%(ENV_DEV_USERNAME)s,USER=%(ENV_DEV_USERNAME)s,XDG_RUNTIME_DIR=/run/user/%(ENV_DEV_UID)s,PULSE_RUNTIME_PATH=/run/user/%(ENV_DEV_UID)s/pulse,DEV_USERNAME=%(ENV_DEV_USERNAME)s,DEV_UID=%(ENV_DEV_UID)s
startretries=3
startsecs=5
stdout_logfile=/var/log/supervisor/pulseaudio.log
stderr_logfile=/var/log/supervisor/pulseaudio.log

[program:audiovalidation]
command=/usr/local/bin/audio-validation.sh
priority=28
autostart=true
autorestart=false
user=root
startsecs=5
startretries=1
stdout_logfile=/var/log/supervisor/audio-validation.log
stderr_logfile=/var/log/supervisor/audio-validation.log

[program:audiomonitor]
command=/usr/local/bin/audio-monitor.sh monitor
priority=30
autostart=true
autorestart=true
user=root
startsecs=10
startretries=3
stdout_logfile=/var/log/supervisor/audio-monitor.log
stderr_logfile=/var/log/supervisor/audio-monitor.log

[program:kasmvnc]
command=/usr/local/bin/start-vnc-robust.sh
priority=40
autostart=true
autorestart=true
stopsignal=TERM
user=%(ENV_DEV_USERNAME)s
startsecs=10
startretries=5
exitcodes=0,1,2
environment=KASMVNC_PORT="%(ENV_KASMVNC_PORT)s",KASMVNC_VNC_PORT="%(ENV_KASMVNC_VNC_PORT)s",DISPLAY=":1",HOME="/home/%(ENV_DEV_USERNAME)s",USER="%(ENV_DEV_USERNAME)s",XDG_RUNTIME_DIR="/run/user/%(ENV_DEV_UID)s"
stdout_logfile=/var/log/supervisor/kasmvnc.log
stderr_logfile=/var/log/supervisor/kasmvnc.log
stdout_logfile_maxbytes=10MB
stderr_logfile_maxbytes=10MB
stdout_logfile_backups=3
stderr_logfile_backups=3

[program:sshd]
command=/usr/sbin/sshd -D
priority=46
autostart=true
autorestart=true
stopsignal=TERM
user=root
stdout_logfile=/var/log/supervisor/sshd.log
stderr_logfile=/var/log/supervisor/sshd.log

[program:ttyd]
command=/bin/bash /usr/local/bin/ttyd-wrapper.sh
priority=48
autostart=true
autorestart=true
stopsignal=TERM
user=root
environment=TTYD_USER=%(ENV_TTYD_USER)s,TTYD_PASSWORD=%(ENV_TTYD_PASSWORD)s,TTYD_PORT=7681
startsecs=10
startretries=5
exitcodes=0,130
stdout_logfile=/var/log/supervisor/ttyd.log
stderr_logfile=/var/log/supervisor/ttyd.log

[program:servicehealth]
command=/usr/local/bin/service-health.sh smart-monitor
priority=52
autostart=true
autorestart=true
user=root
startsecs=15
startretries=3
stdout_logfile=/var/log/supervisor/service-health.log
stderr_logfile=/var/log/supervisor/service-health.log

[program:setupdesktop]
command=/usr/local/bin/setup-desktop.sh
priority=55
autostart=true
autorestart=false
user=root
startsecs=10
startretries=1
stdout_logfile=/var/log/supervisor/setup-desktop.log
stderr_logfile=/var/log/supervisor/setup-desktop.log

[program:systemvalidation]
command=/usr/local/bin/system-validation.sh
priority=60
autostart=true
autorestart=false
user=root
startsecs=20
startretries=1
stdout_logfile=/var/log/supervisor/system-validation.log
stderr_logfile=/var/log/supervisor/system-validation.log

