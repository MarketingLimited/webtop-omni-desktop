# Supervisord configuration for audio system with enhanced monitoring
# This configuration ensures proper audio pipeline initialization and monitoring

[program:audio-routing-monitor]
command=/bin/bash -c 'sleep 15 && /usr/local/bin/fix-audio-routing.sh && while true; do sleep 60; /usr/local/bin/fix-audio-routing.sh >/dev/null 2>&1 || true; done'
directory=/tmp
user=root
autostart=true
autorestart=true
startretries=3
stdout_logfile=/var/log/supervisor/audio-routing.log
stderr_logfile=/var/log/supervisor/audio-routing-error.log
environment=DEV_USERNAME="%(ENV_DEV_USERNAME)s",DEV_UID="%(ENV_DEV_UID)s"

[program:audio-bridge-monitor]
command=/bin/bash -c 'cd /opt/audio-bridge && while true; do node server.js; echo "Audio bridge crashed, restarting in 5 seconds..."; sleep 5; done'
directory=/opt/audio-bridge
user=root
autostart=true
autorestart=true
startretries=999
redirect_stderr=true
stdout_logfile=/var/log/supervisor/audio-bridge.log
environment=NODE_ENV=production

[program:audio-device-monitor]
command=/bin/bash -c 'sleep 20 && while true; do /usr/local/bin/create-virtual-audio-devices.sh >/dev/null 2>&1 || true; sleep 30; done'
directory=/tmp
user=root
autostart=true
autorestart=true
stdout_logfile=/var/log/supervisor/audio-devices.log
stderr_logfile=/var/log/supervisor/audio-devices-error.log
environment=DEV_USERNAME="%(ENV_DEV_USERNAME)s",DEV_UID="%(ENV_DEV_UID)s"